# Telegram Challenge Bot

–õ–µ–≥–∫–æ–≤–µ—Å–Ω—ã–π Telegram –±–æ—Ç –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —á–µ–ª–ª–µ–Ω–¥–∂–∞–º–∏ –≤ –≥—Ä—É–ø–ø–∞—Ö. –ë–æ—Ç –ø—É–±–ª–∏–∫—É–µ—Ç –∑–∞–¥–∞–Ω–∏—è (–æ–ø—Ä–æ—Å—ã), –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∏ –≤–µ–¥–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É.

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- üìä –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—É–±–ª–∏–∫–∞—Ü–∏—è –æ–ø—Ä–æ—Å–æ–≤-–∑–∞–¥–∞–Ω–∏–π –≤ –≥—Ä—É–ø–ø—ã Telegram
- üìà –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞–Ω–∏–π
- üèÜ –°–∏—Å—Ç–µ–º–∞ –±–∞–ª–ª–æ–≤ –∏ —Ä–µ–π—Ç–∏–Ω–≥–æ–≤
- üìÖ –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º–æ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –ø—É–±–ª–∏–∫–∞—Ü–∏–π –∏ –æ—Ç—á–µ—Ç–æ–≤
- üåê –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –≥—Ä—É–ø–ø –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
- ‚öôÔ∏è –ì–∏–±–∫–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ YAML —Ñ–∞–π–ª
- üöÄ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω –¥–ª—è GraalVM Native Image

## –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- **Kotlin** - –æ—Å–Ω–æ–≤–Ω–æ–π —è–∑—ã–∫ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- **ktgbotapi** (TelegramBotAPI) - –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å Telegram Bot API
- **Hoplite** - –∑–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏–∑ YAML
- **Exposed ORM + H2** - —Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
- **kotlinx-coroutines** - –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
- **kotlinx-datetime** - —Ä–∞–±–æ—Ç–∞ —Å –¥–∞—Ç–∞–º–∏ –∏ –≤—Ä–µ–º–µ–Ω–µ–º
- **GraalVM Native** - –∫–æ–º–ø–∏–ª—è—Ü–∏—è –≤ –Ω–∞—Ç–∏–≤–Ω—ã–π –æ–±—Ä–∞–∑

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- JDK 17+ (–¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)
- GraalVM 22+ (–¥–ª—è –Ω–∞—Ç–∏–≤–Ω–æ–π –∫–æ–º–ø–∏–ª—è—Ü–∏–∏)
- Telegram Bot Token (–ø–æ–ª—É—á–∏—Ç—å —É [@BotFather](https://t.me/botfather))

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞

```bash
git clone <repository-url>
cd telegram-challenge-bot
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

–°–∫–æ–ø–∏—Ä—É–π—Ç–µ `config.yaml` –∏ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ –µ–≥–æ:

```bash
cp config.yaml config.yaml.local
```

–ò–∑–º–µ–Ω–∏—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:
- `botToken` - —Ç–æ–∫–µ–Ω –≤–∞—à–µ–≥–æ –±–æ—Ç–∞ –æ—Ç BotFather
- `chatId` - ID —á–∞—Ç–∞/–≥—Ä—É–ø–ø—ã (–º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å —á–µ—Ä–µ–∑ [@userinfobot](https://t.me/userinfobot))
- `threadId` - ID —Ç–µ–º—ã (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –¥–ª—è –≥—Ä—É–ø–ø —Å —Ç–µ–º–∞–º–∏)
- –ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ, –æ–ø—Ü–∏–∏ –æ–ø—Ä–æ—Å–∞ –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –æ—Ç—á–µ—Ç–æ–≤

### 3. –ó–∞–ø—É—Å–∫ –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

```bash
./gradlew run --args="config.yaml.local"
```

–ò–ª–∏ —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è:

```bash
export CONFIG_PATH=config.yaml.local
./gradlew run
```

## –ö–æ–º–ø–∏–ª—è—Ü–∏—è –≤ –Ω–∞—Ç–∏–≤–Ω—ã–π –æ–±—Ä–∞–∑

### –°–±–æ—Ä–∫–∞ –Ω–∞—Ç–∏–≤–Ω–æ–≥–æ –æ–±—Ä–∞–∑–∞

```bash
./gradlew nativeCompile
```

–ò—Å–ø–æ–ª–Ω—è–µ–º—ã–π —Ñ–∞–π–ª –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω –≤ `build/native/nativeCompile/challenge-bot`

### –ó–∞–ø—É—Å–∫ –Ω–∞—Ç–∏–≤–Ω–æ–≥–æ –æ–±—Ä–∞–∑–∞

```bash
./build/native/nativeCompile/challenge-bot config.yaml.local
```

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ config.yaml

```yaml
botToken: "YOUR_BOT_TOKEN"
databasePath: "./challenge-bot.db"

groups:
  - chatId: -1001234567890
    threadId: null
    name: "Group Name"
    
    challenge:
      questionTemplate: "{date} - Your question?"
      isAnonymous: false
      allowsMultipleAnswers: false
      options:
        - text: "Option 1"
          points: 25
          countsAsCompleted: true
        - text: "Option 2"
          points: 50
          countsAsCompleted: true
    
    schedule:
      frequency: DAILY
      time: "09:00:00"
      timezone: "Europe/Moscow"
    
    report:
      frequency: WEEKLY
      dayOfWeek: MONDAY
      time: "20:00:00"
      timezone: "Europe/Moscow"
      includeCompletionStats: true
      includePointsStats: true
      sortBy: POINTS_DESC
```

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

#### Challenge (–ó–∞–¥–∞–Ω–∏–µ)

- `questionTemplate` - —à–∞–±–ª–æ–Ω –≤–æ–ø—Ä–æ—Å–∞, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:
  - `{date}` - –¥–∞—Ç–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ "7 —è–Ω–≤–∞—Ä—è"
  - `{day}` - –¥–µ–Ω—å –º–µ—Å—è—Ü–∞
  - `{month}` - –Ω–∞–∑–≤–∞–Ω–∏–µ –º–µ—Å—è—Ü–∞
  - `{year}` - –≥–æ–¥
  - `{dayOfWeek}` - –¥–µ–Ω—å –Ω–µ–¥–µ–ª–∏

- `options` - –≤–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç–≤–µ—Ç–∞:
  - `text` - —Ç–µ–∫—Å—Ç –≤–∞—Ä–∏–∞–Ω—Ç–∞
  - `points` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–∞–ª–ª–æ–≤ –∑–∞ –≤—ã–±–æ—Ä —ç—Ç–æ–≥–æ –≤–∞—Ä–∏–∞–Ω—Ç–∞
  - `countsAsCompleted` - –∑–∞—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –ª–∏ –∫–∞–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–æ–µ –∑–∞–¥–∞–Ω–∏–µ

#### Schedule (–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ)

- `frequency` - —á–∞—Å—Ç–æ—Ç–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏:
  - `DAILY` - –∫–∞–∂–¥—ã–π –¥–µ–Ω—å
  - `WEEKLY` - –µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ (—É–∫–∞–∑–∞—Ç—å –¥–Ω–∏ –≤ `daysOfWeek`)
  - `CUSTOM` - –∫–∞—Å—Ç–æ–º–Ω–æ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ (—É–∫–∞–∑–∞—Ç—å –¥–Ω–∏ –≤ `daysOfWeek`)

- `time` - –≤—Ä–µ–º—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –≤ —Ñ–æ—Ä–º–∞—Ç–µ "HH:MM:SS"
- `timezone` - —á–∞—Å–æ–≤–æ–π –ø–æ—è—Å (–Ω–∞–ø—Ä–∏–º–µ—Ä, "Europe/Moscow", "UTC")
- `daysOfWeek` - –¥–Ω–∏ –Ω–µ–¥–µ–ª–∏ (–¥–ª—è WEEKLY/CUSTOM): `[MONDAY, TUESDAY, ...]`

#### Report (–û—Ç—á–µ—Ç—ã)

- `frequency` - —á–∞—Å—Ç–æ—Ç–∞ –æ—Ç—á–µ—Ç–æ–≤:
  - `DAILY` - –µ–∂–µ–¥–Ω–µ–≤–Ω–æ
  - `WEEKLY` - –µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ
  - `MONTHLY` - –µ–∂–µ–º–µ—Å—è—á–Ω–æ

- `sortBy` - —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –≤ –æ—Ç—á–µ—Ç–µ:
  - `POINTS_DESC` - –ø–æ —É–±—ã–≤–∞–Ω–∏—é –±–∞–ª–ª–æ–≤
  - `POINTS_ASC` - –ø–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é –±–∞–ª–ª–æ–≤
  - `COMPLETION_DESC` - –ø–æ —É–±—ã–≤–∞–Ω–∏—é –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞–Ω–∏–π
  - `COMPLETION_ASC` - –ø–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞–Ω–∏–π
  - `NAME` - –ø–æ –∏–º–µ–Ω–∏

## –ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å Chat ID

1. –î–æ–±–∞–≤—å—Ç–µ –±–æ—Ç–∞ –≤ –≥—Ä—É–ø–ø—É
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –ª—é–±–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –≥—Ä—É–ø–ø—É
3. –û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ: `https://api.telegram.org/bot<YOUR_BOT_TOKEN>/getUpdates`
4. –ù–∞–π–¥–∏—Ç–µ `"chat":{"id":-1001234567890,...}` - —ç—Ç–æ –≤–∞—à Chat ID

## –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
src/main/kotlin/io/github/alelk/apps/challengetgbot/
‚îú‚îÄ‚îÄ config/          # –ú–æ–¥–µ–ª–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ db/             # –°—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∏ —Å–µ—Ä–≤–∏—Å
‚îú‚îÄ‚îÄ domain/         # –î–æ–º–µ–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏
‚îú‚îÄ‚îÄ repository/     # –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥–∞–Ω–Ω—ã–º–∏
‚îú‚îÄ‚îÄ scheduler/      # –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–¥–∞–Ω–∏–π –∏ –æ—Ç—á–µ—Ç–æ–≤
‚îú‚îÄ‚îÄ telegram/       # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Telegram Bot API
‚îî‚îÄ‚îÄ App.kt          # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
```

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–ë–æ—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `kotlin-logging` —Å `slf4j-simple`. –£—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —á–µ—Ä–µ–∑ `simplelogger.properties`.

## –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License

## –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–ª–∏ –≤–æ–ø—Ä–æ—Å—ã –∏–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã, —Å–æ–∑–¥–∞–π—Ç–µ Issue –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞.

